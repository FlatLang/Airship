package "flatlang/airship/services"

import "flatlang/io/File"
import "flatlang/airship/Airship"
import "flatlang/airship/InvalidCommandException"

class {
  public construct(private Airship airship) {}

  public async reinstall() {
    if (airship.reinstallCommand.values.isEmpty) {
      await airship.uninstallService.uninstall()
      await airship.installService.install()
      return
    }

    for (package in airship.reinstallCommand.values) {
      await reinstall(package)
    }
  }

  async reinstall(String package) {
    if (package.endsWith(".git")) {
      await reinstallGitPackage(package)
    } else {
      throw new InvalidCommandException("Cannot reinstall package '#package'")
    }
  }

  async reinstallGitPackage(String url) {
    await airship.uninstallService.uninstallGitPackage(url)
    await airship.installService.installGitPackage(url, "master")
  }
}