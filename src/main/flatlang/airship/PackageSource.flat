package flatlang/airship

import flatlang/datastruct/HashMap

class {
  visible Dependency[] localDependencies => dependencies.filter({ _.class.isOfType(LocalDependency.class) })

  public construct(
    visible String mainClass,
    visible String outDirectory,
    visible String outFile,
    visible String source,
    visible ExcludedSource[] excludedSources,
    visible DefaultExport[] defaultExports,
    visible Dependency[] dependencies
  ) {}

  public construct(HashMap<String, Object> map) {
    let excludesValue = (Object)(map["excluded"])
    let excludedSourcesArray = (Array)excludesValue
    let excludedSources = excludedSourcesArray?.map({ ExcludedSource(_) })
    let exportsValue = (Object)(map["defaultExports"])
    let defaultExportsArray = (Array)exportsValue
    let defaultExports = defaultExportsArray?.map({ DefaultExport(_) })
    let dependenciesValue = (Object)(map["dependencies"])
    let dependenciesMap = (HashMap)dependenciesValue
    let dependencies = dependenciesMap.map(pair => Dependency((String)pair.key, (String)pair.value))
    this(
      mainClass: (String)map["mainClass"],
      outDirectory: (String)map["outDirectory"],
      outFile: (String)map["outFile"],
      source: (String)map["source"],
      excludedSources: excludedSources ?: Array<ExcludedSource>(),
      defaultExports: defaultExports ?: Array<DefaultExport>(),
      dependencies: dependencies ?: Array<Dependency>()
    )
  }

  override public toString() => "{
      mainClass: \"#mainClass\",
      outDirectory: \"#outDirectory\",
      outFile: \"#outFile\",
      source: \"#source\",
      excludedSources: \"#excludedSources\",
      defaultExports: \"#defaultExports\",
      dependencies: \"#dependencies\"
    }
    |"

  public clone(
    String mainClass = mainClass,
    String outDirectory = outDirectory,
    String outFile = outFile,
    String source = source,
    ExcludedSource[] excludedSources = excludedSources,
    DefaultExport[] defaultExports = defaultExports,
    Dependency[] dependencies = dependencies
  ) => PackageSource(
    mainClass,
    outDirectory,
    outFile,
    source,
    excludedSources,
    defaultExports,
    dependencies
  )
}